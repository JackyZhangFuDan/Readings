# 如果一切从0开始...
> 过去的半年真的是神奇的一段时间，蔡英文胜选，韩国瑜被罢免，新冠肆虐，全民Work From Home，美国的人权运动...... 世界如此繁忙，我却今日得闲，记录一点儿专业方向上的心得。

我目前工作在一个跨国软件项目上，整个项目组一百来号人，我和我的团队在中国，作为该项目的初始参与者， 我们单独负责一个不小的模块，该模块的内容是整个工具的Leading Object，（一旦出错）影响较大。这是一个纯粹的云上开发项目，目标生产环境是Cloud Foundry，搭建软件构架时我们遵从cloud native的最佳实践。我们一切从0开始，8个月后，已经发布了两个版本，这在目标企业数量以万计的软件开发项目里，肯定算是高效的 - 要知道除了功能本身，我们在安全，效率，质量方面需要过五关斩六将，同样耗费大量精力。回顾这8个月，很成功也非常不平坦，很多东西值得总结，我在想，如果时间退回8个月，我被授权负责整个项目，作为管理者该如何更好地组织这种Cloud Native的开发？

## 我们需要怎样的开发团队
必须要重视这个问题。结合经验教训，我想我会把整个项目组拆分成10人大小的多个开发组，每个开发组以Scrum的方式组织，一个Scrum Master，一个Architect， 一个质量专员（并不等同测试人员，下述），其余均为开发人员，可以选择配一个产品功能协调人员，之所以说选配不是说可以没有，而是它可以由质量专员兼任，或者多个开发组共用一个专门做产品需求的人，当然公司财力充足有能力为每个项目组配备一个产品专员当然是最理想。对于成员的素质我们需要把守住底线，管理者必须清楚，人多不等于能力强，不合适的成员只能拖慢整个团队的步伐。
+ 对于项目组的每一个成员，无论角色如何，一个硬性的要求是需要具有技术背景。Scrum Master和产品专员技术要求最弱，但不能对软件开发语言和工具一无所知，质量专员技术要求不高，开发人员要素质过硬。干了这么多年软件开发和项目管理，我确信这会极大***节省交流成本***
+ 产品专员，Scrum Master，Architect 需要做事绝对靠谱（就是说有执行力，可以被信赖），工作非常专注的同事承担。不同工作内容需要的专业素养我们不谈，因为比较容易理解和衡量，靠谱和专注往往由于难于把握而牺牲掉，但我强烈建议重视起来。
+ “一专多能”。有心的读者可能注意到一个细节：10人一个组，就一个质量专员你还强调不等于测试人员，那产品质量怎么整？答案是在我的10人组里，所有的开发人员也都是自动化测试脚本编写人员，我们90%的质量保证要通过自动化的方式来完成，手动测试来把关质量的工作要压缩到最低。自动化在当今软件开发领域是必须的，特别是微服务和云开发，不多说，有怀疑的读者可以读一读这本经典之作：《持续交付-发布可靠软件的系统方法》，作者Jez Humble 和David Farley。关于自动化测试的内容我在下面会简述
+ 高低搭配，可持续发展。选人组队绝对是门学问，有人说我就找最牛的，不要菜鸟，岂有不成功之理？记得上学的时候看世界杯，我对同学说巴西要教练啥用?直接把罗纳尔多卡洛斯等往场上一摆，遇事儿互相喊一下不就得了？大家可能笑了，不可能的，不打起来就不错了~更不用说后备人才培养，考虑下届世界杯的问题了。组队也一样，对于开发人员，从能力角度讲，***我们需要1/3带头人，要有经验有能力有作风；1/3踏实的，颇具经验的合作型队员；和1/3有潜质的菜鸟***。每个开发过程中遇到的稍大的主题，我们以这个比例配备人手，形成一个小的“作战单位”。这样的单位很有战斗力，冲劲儿和经验并存。而且作为管理者，我们要有人才培养的意识以应对频繁的人员流动。

## 该如何协调各个团队
10人一组，那稍大一点儿的项目就会有10多个项目组，协同是个问题，交流成本会不会很大？现在有一门课程就是讲Scale Agile，多敏捷项目组的协调问题，可见这个问题不简单哪。  
团队的协同也不光是人的因素，整个软件系统的构架也有影响，云应用一般都是分布式的应用，各模块之间交互通过消息中间件，这时各个团队会比较独立，技术上大家相互牵绊的可能性不大，所谓协同主要发生在产品专员这个层面。我觉得需要抓住几个关键点。  
+ 制定统一的构建，测试和发布流程，以及标准  
这个后面会作为一个独立部分说明。规则就是协调，以工具来保证的规则是最有力的协调。
+ 产品功能集中设计  
在微服务的体系下，我们不要求各个项目组的实现方式 （当然绝大多数项目在启动之初就会定下所要使用的开发框架，这个不矛盾），但我们的产品必须以统一的方式呈现给用户。所以产品协调员必须形成一个整体，集中设计产品，然它各模块之间的衔接顺畅，用户体验一致，产品协调员会把己方所负责的部分带回小团队进行讲解和设定交付期限，并把己方开发的状态与其它协调员共享。  
+ 信息全透明  
产品的背景知识，设计决议以及计划信息要保持对全项目组透明，并且做到信息组织有序，主动推送。在我的经历里这种方式是非常有效的，举例子，为了避免关于产品功能的实现方式的决定广泛分布于邮件，Slack，Teams，Sharepoint等地，我们规定统一在Jira中该User Story下，以comment的形式记录各重要变更和决定，效果很好。

## 开发，测试与发布  
让我们***以CI/CD的思想和工具，在开发真正开始之前，就搭建好开发，自动化测试和发布的流程***。这可能是这个项目带给我的最大的收获，我们不是“最好”这样做，而是”一定“这样做。为什么说的这么绝对？我们简化一下问题，你设想一下你有一条Pipeline（什么？还不知道啥是pipeline？请先搜一把），它包含多个stage，典型的有：发现代码库有新提交；把code拉下来build；运行单元测试，对比预定KPI；进行Component测试，对比预定KPI；部署进Test环境；运行End to End测试，对比预定KPI；手动决定是否进行下一步；向生产环境部署。你发现吗，它涵盖了大部分重要的软件工程步骤：构建，测试和部署。如果这条pipeline能建好，每个开发团队都能顺利通过这条pipeline形成产出（进入生产环境），意味着我们针对构建，质量和部署相关的要求（各种我们认为必要的KPI）都已满足，在测试系统已经经过自动化测试的检测证明刚刚发布的一小块可以很好地和其它块正常工作。所以这条pipeline自动化地保证了规则的满足，让人兴奋的是这还是一个可靠可重复高效的方式！

这方面的内容有太多可以深入讨论的细节，比如代码是单库多分枝还是多库单分支等等，如果再考虑到不同项目的不同需求，这种变种就更多了，讨论。从工具角度讲我认为Github，Jenkins和主流的云平台如Azure，AWZ，SAP Cloud Platform已经足够灵活，通过一些客制化开发（瞧，这就是为什么我强调组员要有技术背景的原因）基本都可以满足，所以我想强调的是，建立的过程不会一马平川，但不要轻易放弃，发挥技术的魔力去解决它，然后happy的开发，happy的发布:-D  

强调一下，我希望从第一行产品代码被写出之前，就已经确定并搭起了这条自动化处理框架，而不是边开发边搭建。可以允许这条框架的某些细节后续添加上来，但主要组成部分必须从第一天代码编写就已经存在。我经历了违反这条所带来的大量精力耗费，这辈子也不想再重蹈覆辙。这会不会造成项目的拖延呢？在一个合格的项目管理者手上这大概率不会发生，在技术人员搭建自动化框架的时候，产品团队正在共同制定产品蓝图，按照Domain Driven Design的指引划分微服务的边界，架构师们正在针对可用的技术框架进行选型，这三项任务互不干扰，完全可以齐头并进。

## 开发模式  
我是敏捷思想的忠实粉丝，所以会要求各个10人团队根据Scrum过程的指引，制定出自己的敏捷项目过程。之所以简单copy Scrum的方法论，也算是自己经验的一种体现吧，照搬照抄永远达不到最好，倒不如正视差异的存在，同时激发团队的自主意识责任意识。为了所有团队不偏离敏捷本质，我们需要集中培训Scrum Master，告诉他们Scrum的理论。同时我们要向Scrum Master明确：我们不需要只知道Schedule会议的Master，我们需要“沉浸”式的项目一员，他/她的身影活跃在所有需要穿针引线的场景，他/她的神经始终关注着项目的关键事项状态，他/她的心思始终在团队障碍和进度推进。这才是做Scrum Master的正确姿势。

除了Scrum，开发模式还需要引入Test Driven Development和Behavior Drive Development，TDD我想大家可能都听说过，最主要的原则是先有Unit Test再有生产代码（当然为什么这么做才是精髓，不能展开，够说一天了），而BDD威力更大，在精炼并准确地表达需求，避免误解方面实属利器，另外呢，它还会把开发流程最前段的需求和最终的产品质量链接起来，让机器能自动，高效，可回归地验证需求的实现情况，感兴趣的可以参见我的[另一片文章](BDD.md)

## 到此为止  
我觉得到此为止不多说了，因为可说的太多了～ 有收不住的风险 :-), 说多了呢读者容易失去焦点还不如只说重点。以上四点是我觉得的重点，做软件项目绝不简单，很劳神，编码部分很关键但绝对是属于省心的那一块，我这么说干过编码干过管理的肯定会心一笑，呵呵。